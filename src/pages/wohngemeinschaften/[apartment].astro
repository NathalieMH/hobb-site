---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";
const base = import.meta.env.BASE_URL;

export async function getStaticPaths() {
  const apartments = await getCollection("apartments");
  return apartments.map(({ slug }) => ({ params: { apartment: slug } }));
}

const { apartment } = Astro.params; // e.g., "apartment-3"
const apartments = await getCollection("apartments");
const apt = apartments.find(a => a.slug === apartment);

// Rooms are linked via apartment that equals the apartment slug
const rooms = await getCollection("rooms", r => r.data.apartment === apartment);
---
<Layout title={apt?.data.title ?? "Wohngemeinschaft"}>
  <h1>{apt?.data.title ?? "Wohngemeinschaft"}</h1>
  <h2>Zimmer</h2>
  <ul>
    {rooms.map(({ data, slug }) => (
      <li><a href={`${import.meta.env.BASE_URL}zimmer/${slug}/`}>{data.title}</a>{data.teaser ? ` â€” ${data.teaser}` : ""}</li>
    ))}
  </ul>
</Layout>
